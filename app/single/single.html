<nav ng-include src="'app-bar/app-bar.html'" ng-controller="appBarController" class="main-nav navbar navbar-fixed-top"></nav>

<section class="col-sm-8 col-sm-offset-2 {{post.type}}" id="post">
	<ul ng-if="$root.user._id === post.userId" class="single-post-menu">
		<li id="delete_post_sequence">
			<button class="btn btn-primary" ng-if="!deletePostClicked" ng-click="deletePostClick('try')">Delete</button>
			<button class="btn btn-primary" ng-show="deletePostClicked" ng-click="deletePost(post._id)">Yes</button>
			<button class="btn btn-primary" ng-show="deletePostClicked" ng-click="deletePostClick('cancel')">No</button>
		</li>
		<li>Edit post (coming soon)</li>
	</ul>

	<div ng-if="post.type == 'quest' && $root.user._id == post.userId">
		<ul ng-if="post.quest.status !== 'completed'">
			<li>
				<button ng-click="allCompletedQuest(post._id, post.usersMentioned)">Everyone completed the quest</button>
			</li>
			<li ng-repeat="user in post.usersMentioned">
				<button ng-click="completedQuest(post._id, user)">@{{user}} completed the quest</button>
			</li>
		</ul>

		<button ng-if="post.quest.status === 'completed'" ng-click="undoCompletedQuest(post._id, post.usersMentioned, 'failed')">JK everyone failed</button>
		<button ng-if="post.quest.status === 'completed'" ng-click="undoCompletedQuest(post._id, post.usersMentioned, 'in_progress')">JK it's not finished</button>
	</div>

	<div ng-if="post.type == 'quest'">
		<div ng-if="post.usersMentioned.indexOf($root.user.username) === -1">
			<h2 ng-if="post.quest.status === 'completed'">Success!</h2>
			<h2 ng-if="post.quest.status === 'in_progress'">In Progress</h2>
			<h2 ng-if="post.quest.status === 'failed'">Failed</h2>
		</div>
		<div ng-if="post.usersMentioned.indexOf($root.user.username) > -1">
			<div ng-if="post.quest.completers.indexOf($root.user.username) > -1">
				<h2>Success!</h2>
				<p>You completed the quest!</p>
			</div>
			<div ng-if="post.quest.completers.indexOf($root.user.username) === -1 && post.quest.status === 'in_progress'">
				<h2>Still working...</h2>
				<p>You haven't completed this quest yet.</p>
			</div>
			<div ng-if="post.quest.completers.indexOf($root.user.username) === -1 && post.quest.status === 'failed'">
				<h2>Boooo!</h2>
				<p>You failed this quest.</p>
			</div>
		</div>
	</div>

	<div class="post-image" ng-if="post.image">
		<img src="{{post.image}}" alt="{{post.content}}">
	</div>
	<div class="author">
		<span class="author-username">{{post.user}}</span>
		<img data-user-id="{{post.userId}}" alt="{{post.user}}" class="avatar img-responsive" /> <!-- ng-src="{{post.avatar}}" -->
	</div>
	<div class="date">
		{{post.date | date: 'MM/dd/yyyy hh:mm'}}
	</div>

	<article class="content">
		{{post.content}}
	</article>

	<section class="comments">
		<div ng-repeat="comment in post.comments" class="comment">{{comment.authorName}} said: {{comment.content}}</div>

		<button ng-show="!allowAddComment" ng-click="allowAddComment = true">Add a comment</button>
		<form ng-show="allowAddComment" ng-submit="postComment(); allowAddComment = false">
			<input type="text" ng-keyup="generateLinkPreview()" ng-model="newComment.content" placeholder="Write a comment">
			<div ng-if="linkPreview" class="link-preview">
				<div class="link-preview-thumbnail">
					<img src="{{linkPreview.src}}" alt="{{linkPreview.title}}">
				</div>
				<div class="link-preview-text">
					<h3>{{linkPreview.title}}</h3>
					<p>{{linkPreview.description}}</p>
				</div>
			</div>
			<button>Post comment</button>
		</form>
	</section>
</section>