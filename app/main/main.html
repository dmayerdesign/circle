<nav ng-include src="'app-bar/app-bar.html'" ng-controller="appBarController" class="main-nav navbar navbar-fixed-top"></nav>

<main ng-if="circleJoined && user.isEmailVerified" ng-class="applyFilterClasses()">
	<nav class="col-md-8 col-md-offset-2 circle-nav">
		<div class="circle-nav-inner circle-sorting">
			<div class="c-bg-primary tile clearfix">
				<button class="inner-btn c-bg-accent-hover" ng-click="orderPosts('date')"><span>Recent</span></button>
				<button class="inner-btn c-bg-accent-hover" ng-click="orderPosts('votes')"><span>Best</span></button>
			</div>
		</div>

		<div class="circle-nav-inner circle-views">
			<div class="c-bg-primary tile clearfix">
				<button class="inner-btn c-bg-accent-hover" ng-click="showTagsDropdown()"><span>Categories</span></button>
				<button class="inner-btn c-bg-accent-hover"><span>Friends</span></button>
				<button ng-click="showPostsOfType('event')" class="inner-btn c-bg-accent-hover"><span>Calendar</span></button>
				<button ng-click="showPostsOfType('quest')" class="inner-btn c-bg-accent-hover"><span>Quests</span></button>
			</div>
		</div>

		<div ng-show="tagsDropdownVisible" class="tags-dropdown c-bg-primary">
			<ul>
				<li ng-repeat="tag in circle.tags"><button ng-click="showPostsTagged(tag)" class="inner-btn square-btn">{{tag}}</button></li>
			</ul>
		</div>
	</nav>

<!-- POSTS MAIN -->
	<section class="posts-archive-container">
		<button ng-click="setNewPosts(); showPostsTagged(); showPostsOfType();" class="btn btn-primary">All Posts<span ng-if="incomingPosts && difference">({{difference}} new)</span></button>
		<div class="col-md-8 col-md-offset-2 posts-archive archive">

			<!-- post -->
			<div ng-repeat="post in posts | orderBy: postOrder | limitTo:postsAllowed['allow']" class="post archive-post col-md-6 not-treated" data-post-id="{{post._id}}" data-creator-id="{{post.userId}}" data-link-set="{{post.link}}" ng-click="$parent.goToPost(post._id)">
				<div class="post-inner c-bg-content tile" back-img="{{archiveLinkPreviews[post._id].src}}" back-img="getPostImage(post)">
					<!-- <div class="post-bg"></div>  -->
					<div class="post-meta">
						<div class="author">
							<span data-user-id="{{post.userId}}" class="author-username">{{post.user}}</span>
							<div class="avatar-container"><img ng-src="{{post.avatar}}" data-user-id="{{post.userId}}" alt="{{post.user}}" class="avatar img-responsive" /></div>
						</div>
						<div class="date">
							{{post.date | date: 'MM/dd/yyyy hh:mm'}}
						</div>
					</div>
					<div class="content">
						<article>{{post.content}}</article>
						<div ng-if="archiveLinkPreviews[post._id]" class="posted-link-preview">{{archiveLinkPreviews[post._id].title}}</div>
					</div>
					<!-- <div class="comments" ng-repeat="comment in post.comments">
						<div class="avatar-container"><img data-user-id="{{comment.userId}}" alt="{{comment.user}}" class="avatar img-responsive" /></div>
					</div> -->
				</div>
			</div>
			<!-- /post -->

			<button class="btn btn-primary" ng-click="loadMore()">Load more</button>
		</div>
	</section>

	<aside id="users" class="col-md-8 col-md-offset-2">
		<div ng-repeat="user in users" class="row">
			{{user.email}}
		</div>
	</aside>

	<section id="new-post-area" class="bottom-drawer bottom-drawer-add c-bg-primary" aria-hidden="true">
		<div class="col-md-8 col-md-offset-2">

			<!-- POST TYPE TABS -->
			<div class="tabs radio-tabs">
				<input ng-model="newPost.type" id="post_type_regular" name="postType" value="regular" type="radio" />
				<label class="inner-btn new-post-type-regular post-type-radio" for="post_type_regular">Regular</label>

				<input ng-model="newPost.type" id="post_type_event" name="postType" value="event" type="radio" />
				<label class="inner-btn new-post-type-event post-type-radio" for="post_type_event">Event</label>

				<input ng-model="newPost.type" id="post_type_quest" name="postType" value="quest" type="radio" />
				<label class="inner-btn new-post-type-quest post-type-radio" for="post_type_quest">Quest</label>
			</div>

			<!-- POST INPUT MAIN -->
			<div class="new-post-content">
				<textarea ng-model="newPost.content" ng-keyup="generateLinkPreview()" id="new_post_content" class="form-control" placeholder="Type something, then press 'Enter' to post it"></textarea>
				
				<div ng-if="linkPreview" class="link-preview">
					<div class="link-preview-thumbnail">
						<img src="{{linkPreview.src}}" alt="{{linkPreview.title}}">
					</div>
					<div class="link-preview-text">
						<h3>{{linkPreview.title}}</h3>
						<p>{{linkPreview.description}}</p>
					</div>
				</div>
			</div>

			<!-- ASSIGN QUESTER -->
			<div ng-if="newPost.type === 'quest'" class="tabs radio-tabs select-quester">
				<div ng-repeat="user in users">
					<input ng-model="newPost.quest.questers[user._id]" id="quester_{{user._id}}" name="quester" value="{{user._id}}" type="checkbox" />
					<label class="inner-btn new-quest-quester quester-radio" for="quester_{{user._id}}">{{user.username || user.email}}</label>
				</div>
			</div>

			<!-- TAGS -->
			<div class="new-post-tags"><input ng-model="newPost.tags" ng-keypress="sendPost($event)" type="text" class="form-control" placeholder="tag this post"></input></div>

			<div class="tags-search">
				<div class="multiple-selector">
					<ul class="select">
						<li class="option" data-option="{{tag}}" ng-click="customSelect( '.new-post-tags > input', $event )" ng-repeat="tag in circle.tags">{{tag}}</li>
					</ul>
				</div>
			</div>
			<button ng-click="sendPost()" class="btn btn-primary">Post</button>
		</div>
	</section>

	<section ng-controller="editCircleController" class="bottom-drawer bottom-drawer-edit-circle c-bg-primary" aria-hidden="true">
		<div class="col-md-8 col-md-offset-2">
			<div class="row">
				<div class="col-md-6 col-md-offset-3">
					<p>Change the theme</p>
					<select ng-model="$parent.style.theme" ng-blur="editCircle('theme')" type="text" class="form-control">
						<option ng-selected="circle.styles.theme == 'smooth'" value="smooth">Smooth</option>
						<option ng-selected="circle.styles.theme == 'material'" value="material">Material</option>
					</select>
				</div>
			</div>

			<div class="row">
				<div class="col-md-6 col-md-offset-3">
					<p>Change the palette</p>
					<select ng-model="$parent.style.palette" value="{{circle.styles.palette}}" ng-blur="editCircle('palette')" type="text" class="form-control">
						<option ng-selected="circle.styles.palette == 'original'" value="original">Original</option>
						<option ng-selected="circle.styles.palette == 'light'" value="light">Light</option>
						<option ng-selected="circle.styles.palette == 'dark'" value="dark">Dark</option>
					</select>
				</div>
			</div>

			<div class="row">
				<div class="col-md-6 col-md-offset-3">
					<p>Change the font</p>
					<select ng-model="$parent.style.font" value="{{circle.styles.font}}" ng-blur="editCircle('font')" type="text" class="form-control">
						<option ng-selected="circle.styles.font == 'open-sans'" value="open-sans">Open Sans</option>
						<option ng-selected="circle.styles.font == 'montserrat'" value="montserrat">Montserrat</option>
					</select>
				</div>
			</div>

	<!-- 		<div class="row">
				<div class="col-sm-6 col-sm-offset-3">
					<p>Insert some CSS (experts only)</p>
					<textarea ng-model="$parent.style.css" placeholder="example: .tile { border: 2px solid pink; }" ng-blur="editCircle('css')" class="form-control"></textarea>
				</div>
			</div> -->

			<div class="row">
				<div class="col-md-6 col-md-offset-3">
					<p>Change the background</p>
					<div class="button" ngf-select="upload($file)">Select</div>
				</div>
			</div>
		</div>
	</section>
</main>

	